<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Elwyn AI</title>
  <meta name="theme-color" content="#7A1E2C" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0f1317; --panel:#12181f; --text:#e9eef3; --muted:#a9b1bd; --line:#233041; --primary:#7A1E2C; --primary-2:#8F2A3A; --ok:#49d19a; --err:#ff8a8a; --elev:0 8px 24px rgba(0,0,0,.35); --radius:14px; --focus:#8ec9ff; }
    body[data-theme="classic"]{ --bg:#0f1317; --panel:#12181f; --text:#e9eef3; --muted:#a9b1bd; --line:#233041; --primary:#7A1E2C; --primary-2:#8F2A3A; }
    body[data-theme="midnight"]{ --bg:#0b0f14; --panel:#111622; --text:#dfe8f5; --muted:#9fb0c7; --line:#1e2b41; --primary:#2f6be0; --primary-2:#3a7bff; }
    body[data-theme="forest"]{ --bg:#0e1411; --panel:#121a16; --text:#e8f4ec; --muted:#a7c3b1; --line:#1c3327; --primary:#1f8a5b; --primary-2:#26a06a; }
    body[data-theme="ocean"]{ --bg:#0c1318; --panel:#101a22; --text:#e8f7ff; --muted:#a7c6d6; --line:#1f3442; --primary:#0fa3c9; --primary-2:#18b5dd; }
    body[data-theme="solar"]{ --bg:#0f1114; --panel:#151922; --text:#fff6e6; --muted:#e0cfa6; --line:#2c2a20; --primary:#ffb020; --primary-2:#ffc241; }
    body[data-theme="orchid"]{ --bg:#130f14; --panel:#1b141c; --text:#f8ecff; --muted:#d0b7de; --line:#2e2331; --primary:#b15bd4; --primary-2:#c778e7; }
    body[data-theme="slate"]{ --bg:#0f1113; --panel:#15181c; --text:#e8edf3; --muted:#b1bcc9; --line:#232a33; --primary:#5c7cff; --primary-2:#7791ff; }
    body[data-theme="sand"]{ --bg:#0f100f; --panel:#171814; --text:#f4efe6; --muted:#d8cfbe; --line:#2e2a20; --primary:#d6a15b; --primary-2:#e2b16c; }
    body[data-theme="rose"]{ --bg:#111014; --panel:#18161c; --text:#ffeef3; --muted:#e3c1cd; --line:#2e2331; --primary:#d6537a; --primary-2:#e06c90; }
    body[data-theme="contrast"]{ --bg:#000; --panel:#0e0e0e; --text:#fff; --muted:#cfd6df; --line:#2b2b2b; --primary:#00d18f; --primary-2:#25e0a7; }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: radial-gradient(1200px 800px at -10% -10%, color-mix(in oklab, var(--panel) 40%, black) 0%, var(--bg) 60%) fixed;
    }

    .topbar{ background:linear-gradient(90deg,var(--primary) 0%,var(--primary-2) 100%); border-bottom:1px solid color-mix(in oklab, #fff 6%, transparent); position:sticky; top:0; z-index:5; }
    .wrap{ max-width:1200px; margin:0 auto; padding:12px 16px; display:flex; align-items:center; gap:12px }
    .brand{ display:flex; align-items:center; gap:10px; color:#fff; text-decoration:none }
    .logo{ width:34px; height:34px; border-radius:8px; background:#fff; color:var(--primary); display:grid; place-items:center; font-weight:800; box-shadow:var(--elev) }

    .layout{ max-width:1200px; margin:20px auto; display:grid; grid-template-columns:280px 1fr; gap:18px; padding:0 16px }
    .side{ position:sticky; top:16px; align-self:start }
    .side-group{ background:color-mix(in oklab, var(--panel) 85%, transparent); border:1px solid var(--line); border-radius:var(--radius); padding:14px; box-shadow:var(--elev); margin-bottom:12px }
    .side-title{ font-weight:700; margin-bottom:8px }
    .side-link{ width:100%; text-align:left; padding:10px 12px; border-radius:10px; border:1px solid var(--line); background:color-mix(in oklab, var(--panel) 70%, black 30%); color:var(--text); margin-bottom:8px; cursor:pointer; transition:.15s }
    .side-link.is-active,.side-link:hover{ background:color-mix(in oklab, var(--panel) 55%, var(--primary) 20%); border-color:color-mix(in oklab, var(--line) 70%, var(--primary) 30%) }

    .select,.engine{ width:100%; background:color-mix(in oklab, var(--panel) 85%, #000 15%); color:var(--text); border:1px solid var(--line); border-radius:10px; padding:10px; }
    .card{ background:var(--panel); border:1px solid var(--line); border-radius:16px; box-shadow:var(--elev); padding:16px }
    .muted{ color:var(--muted) }
    .grid{ display:grid; gap:12px }
    .row{ display:flex; gap:10px; flex-wrap:wrap }
    .btn{ appearance:none; border:1px solid color-mix(in oklab, var(--line) 80%, #fff 0%); background:color-mix(in oklab, var(--panel) 85%, #000 15%); color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer; transition:.15s }
    .btn:hover{ background:color-mix(in oklab, var(--panel) 70%, var(--primary) 10%) } .btn.primary{ background:var(--primary); border-color:var(--primary-2) } .btn.primary:hover{ background:var(--primary-2) }
    textarea{ width:100%; background:color-mix(in oklab, var(--panel) 85%, #000 15%); color:var(--text); border:1px solid var(--line); border-radius:10px; padding:10px; resize:vertical }
    .chat-log{ max-height:420px; overflow:auto; border:1px dashed color-mix(in oklab, var(--line) 90%, #000 10%); border-radius:12px; padding:12px; background:color-mix(in oklab, var(--panel) 75%, #000 25%) }
    .bubble{ padding:10px 12px; border-radius:12px; margin:8px 0; line-height:1.5; white-space:pre-wrap; animation:fade .12s ease }
    .bubble.user{ background:color-mix(in oklab, var(--panel) 70%, #000 30%); border:1px solid var(--line) }
    .bubble.assistant{ background:color-mix(in oklab, var(--primary) 18%, var(--panel) 82%); border:1px solid color-mix(in oklab, var(--primary) 35%, var(--line) 65%) }
    @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
    .panel{ display:none } .panel.is-visible{ display:block }
    .footer{ margin:30px 0; color:var(--muted); text-align:center }

    @media (max-width: 1000px){ .layout{ grid-template-columns: 1fr } .side{ position:static } }
  </style>
</head>

<body data-theme="classic">
  <header class="topbar">
    <div class="wrap">
      <a class="brand" href="#" aria-label="Elwyn Home">
        <div class="logo">E</div>
        <div><strong>Elwyn AI</strong></div>
      </a>
    </div>
  </header>

  <main class="layout">
    <!-- LEFT: Nav first -->
    <aside class="side">
      <div class="side-group">
        <div class="side-title">Navigate</div>
        <button class="side-link is-active" data-view="chat">Chat</button>
        <button class="side-link" data-view="image">Text → Image</button>
        <button class="side-link" data-view="video">Text → Video (soon)</button>
        <button class="side-link" data-view="audio">Text → Audio (soon)</button>
        <button class="side-link" data-view="mission">Mission</button>
      </div>

      <!-- Tools BELOW -->
      <div class="side-group">
        <div class="side-title">Tools</div>
        <label class="muted tiny" for="themeSelect">Theme</label>
        <select id="themeSelect" class="select" aria-label="Choose theme">
          <option value="classic" selected>Classic (Burgundy)</option>
          <option value="midnight">Midnight</option>
          <option value="forest">Forest</option>
          <option value="ocean">Ocean</option>
          <option value="solar">Solar</option>
          <option value="orchid">Orchid</option>
          <option value="slate">Slate</option>
          <option value="sand">Sand</option>
          <option value="rose">Rose</option>
          <option value="contrast">High Contrast</option>
        </select>

        <label class="muted tiny" for="engineSelect" style="margin-top:8px;display:block">Model</label>
        <select id="engineSelect" class="engine" aria-label="Model">
          <option value="latest">Latest (auto)</option>
          <option value="model-5-thinking" selected>model-5-thinking</option>
          <option value="model-5">model-5</option>
          <option value="model-4o">model-4o</option>
          <option value="model-4o-mini">model-4o-mini</option>
        </select>
      </div>
    </aside>

    <!-- RIGHT: Views -->
    <section id="view" class="grid">

      <!-- Chat -->
      <section class="panel is-visible" data-panel="chat">
        <div class="card">
          <h2>Ask Elwyn AI</h2>
          <p class="muted">Smart chat with built-in tools for time, weather, and web/news lookups.</p>
          <div class="grid">
            <div id="chatLog" class="chat-log" aria-live="polite"></div>
            <form id="chatForm" class="grid">
              <label class="muted" for="chatBox" style="display:flex;align-items:center;gap:6px">
                <span style="font-weight:700">Ask Anything</span> <span aria-hidden="true">→</span>
              </label>
              <textarea id="chatBox" rows="4" placeholder='Try: "time in London", "weather in Lagos", "latest news on AI safety"'></textarea>
              <div class="row">
                <button class="btn primary" type="submit">Send</button>
                <button class="btn" type="button" id="clearChat">Clear</button>
                <button class="btn" type="button" id="useMyLocation" title="Use device location for time & weather">Use my location</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- Text → Image -->
      <section class="panel" data-panel="image">
        <div class="card">
          <h2>Text → Image</h2>
          <form id="imgForm" class="grid">
            <textarea id="imgPrompt" rows="3" placeholder="Describe the image…"></textarea>
            <div class="row"><button class="btn primary" type="submit">Generate</button></div>
          </form>
          <div id="imgOut" class="grid"></div>
        </div>
      </section>

      <!-- Video placeholder -->
      <section class="panel" data-panel="video">
        <div class="card"><h2>Text → Video</h2><p class="muted">Coming soon.</p></div>
      </section>

      <!-- Audio placeholder -->
      <section class="panel" data-panel="audio">
        <div class="card"><h2>Text → Audio</h2><p class="muted">Coming soon.</p></div>
      </section>

      <!-- Mission (kept exactly as in your last full replace-all) -->
      <section class="panel" data-panel="mission">
        <div class="card">
          <h2>Mission — Non-Profit Behavioral Health (AI-assisted, human-in-the-loop)</h2>
          <p class="muted">
            We deliver equitable behavioral care at scale with a hybrid model: models handle continuous monitoring, analysis,
            and immediate support; licensed clinicians lead complex therapy, crisis work, and individualized planning.
          </p>
          <!-- (Mission content omitted here for brevity; keep your previous Mission section unchanged) -->
        </div>
      </section>

    </section>
  </main>

  <footer class="footer">© 2025 Elwyn AI</footer>

  <script>
    const WORKER_URL = "/api";
    const DEFAULT_MODEL = "model-5-thinking";
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>[...document.querySelectorAll(s)];
    const currentModel = ()=> $("#engineSelect")?.value || DEFAULT_MODEL;

    // Theme persistence
    (()=>{
      const sel=$("#themeSelect"); const saved=localStorage.getItem("elwyn:theme");
      if(saved){ document.body.setAttribute("data-theme", saved); if(sel) sel.value=saved; }
      sel?.addEventListener("change", ()=>{ const t=sel.value; document.body.setAttribute("data-theme", t); localStorage.setItem("elwyn:theme", t); });
    })();

    // Device location cache
    const geoKey = "elwyn:geo";
    async function updateGeoFromDevice(){
      if(!("geolocation" in navigator)) return null;
      return new Promise((resolve)=> {
        navigator.geolocation.getCurrentPosition(
          (pos)=>{ 
            const g={ lat:pos.coords.latitude, lon:pos.coords.longitude, ts:Date.now() };
            localStorage.setItem(geoKey, JSON.stringify(g)); resolve(g);
          },
          ()=>resolve(null),
          { enableHighAccuracy:false, timeout
